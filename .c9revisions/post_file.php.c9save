{"ts":1350185832246,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<?php\r\n\r\n// If you want to ignore the uploaded files, \r\n// set $demo_mode to true;\r\n\r\n$demo_mode = false;\r\n$upload_dir = 'uploads/';\r\n$allowed_ext = array('jpg','jpeg','png','gif');\r\n\r\n\r\nif(strtolower($_SERVER['REQUEST_METHOD']) != 'post'){\r\n    exit_status('Error! Wrong HTTP method!');\r\n}\r\n\r\n\r\nif(array_key_exists('pic',$_FILES) && $_FILES['pic']['error'] == 0 ){\r\n\t\r\n\t$pic = $_FILES['pic'];\r\n\r\n\tif(!in_array(get_extension($pic['name']),$allowed_ext)){\r\n\t\texit_status('Only '.implode(',',$allowed_ext).' files are allowed!');\r\n\t}\t\r\n\r\n\tif($demo_mode){\r\n\t\t\r\n\t\t// File uploads are ignored. We only log them.\r\n\t\t\r\n\t\t$line = implode('\t\t', array( date('r'), $_SERVER['REMOTE_ADDR'], $pic['size'], $pic['name']));\r\n\t\tfile_put_contents('log.txt', $line.PHP_EOL, FILE_APPEND);\r\n\t\t\r\n\t\texit_status('Uploads are ignored in demo mode.');\r\n\t}\r\n\t\r\n\t\r\n\t// Move the uploaded file from the temporary \r\n\t// directory to the uploads folder:\r\n\t\r\n\tif(move_uploaded_file($pic['tmp_name'], $upload_dir.$pic['name'])){\r\n\t\texit_status('File was uploaded successfuly!');\r\n\t}\r\n\t\r\n}\r\n\r\nexit_status('Something went wrong with your upload!');\r\n\r\n\r\n// Helper functions\r\n\r\nfunction exit_status($str){\r\n\techo json_encode(array('status'=>$str));\r\n\texit;\r\n}\r\n\r\nfunction get_extension($file_name){\r\n\t$ext = explode('.', $file_name);\r\n\t$ext = array_pop($ext);\r\n\treturn strtolower($ext);\r\n}\r\n?>"]],"start1":0,"start2":0,"length1":0,"length2":1357}]],"length":1357}
{"contributors":[],"silentsave":false,"ts":1350185813133,"patch":[[{"diffs":[[1,"<?php\r\n\r\n// If you want to ignore the uploaded files, \r\n// set $demo_mode to true;\r\n\r\n$demo_mode = false;\r\n$upload_dir = 'uploads/';\r\n$allowed_ext = array('jpg','jpeg','png','gif');\r\n\r\n\r\nif(strtolower($_SERVER['REQUEST_METHOD']) != 'post'){\r\n    exit_status('Error! Wrong HTTP method!');\r\n}\r\n\r\n\r\nif(array_key_exists('pic',$_FILES) && $_FILES['pic']['error'] == 0 ){\r\n\t\r\n\t$pic = $_FILES['pic'];\r\n\r\n\tif(!in_array(get_extension($pic['name']),$allowed_ext)){\r\n\t\texit_status('Only '.implode(',',$allowed_ext).' files are allowed!');\r\n\t}\t\r\n\r\n\tif($demo_mode){\r\n\t\t\r\n\t\t// File uploads are ignored. We only log them.\r\n\t\t\r\n\t\t$line = implode('\t\t', array( date('r'), $_SERVER['REMOTE_ADDR'], $pic['size'], $pic['name']));\r\n\t\tfile_put_contents('log.txt', $line.PHP_EOL, FILE_APPEND);\r\n\t\t\r\n\t\texit_status('Uploads are ignored in demo mode.');\r\n\t}\r\n\t\r\n\t\r\n\t// Move the uploaded file from the temporary \r\n\t// directory to the uploads folder:\r\n\t\r\n\tif(move_uploaded_file($pic['tmp_name'], $upload_dir.$pic['name'])){\r\n\t\texit_status('File was uploaded successfuly!');\r\n\t}\r\n\t\r\n}\r\n\r\nexit_status('Something went wrong with your upload!');\r\n\r\n\r\n// Helper functions\r\n\r\nfunction exit_status($str){\r\n\techo json_encode(array('status'=>$str));\r\n\texit;\r\n}\r\n\r\nfunction get_extension($file_name){\r\n\t$ext = explode('.', $file_name);\r\n\t$ext = array_pop($ext);\r\n\treturn strtolower($ext);\r\n}\r\n?>"]],"start1":0,"start2":0,"length1":0,"length2":1357}]],"length":1357,"saved":false}
